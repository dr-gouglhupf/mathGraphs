var graph=function(t,u){var v=this.options={size:{width:function(){return window.innerHeight<window.innerWidth?window.innerHeight-20:window.innerWidth-20},height:function(){return window.innerHeight<window.innerWidth?window.innerHeight-20:window.innerWidth-20}},gridSettings:{range:{xM:-10,xP:10,yM:-10,yP:10},colors:{axes:"#E4EDF0",temLines:"#7f8c8d",text:"#7f8c8d"},referenceLines:!0,text:!0},toopTips:{enable:!0,roundEdges:!0,width:140,fontColor:"#e3f2fd",template:"P(<x(1)>, <y(1)>)<br>f(x) = <formula>"},
fontType:"Arial",changeOnResize:!0,randomColors:!0,moveEnable:!0,zoomEnable:!0,colors:"rgb(26, 188, 156);rgb(46, 204, 113);rgb(52, 152, 219);rgb(155, 89, 182);rgb(52, 73, 94);rgb(22, 160, 133);rgb(39, 174, 96);rgb(41, 128, 185);rgb(142, 68, 173);rgb(44, 62, 80);rgb(241, 196, 15);rgb(230, 126, 34);rgb(231, 76, 60);rgb(243, 156, 18);rgb(211, 84, 0);rgb(192, 57, 43)".split(";")},h={},w=h.merge=function(a,b){"object"!==typeof a&&(a={});for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];a[c]="object"===
typeof d?h.merge(a[c],d):d}c=2;for(d=arguments.length;c<d;c++)w(a,arguments[c]);return a};h.getRandomArbitrary=function(a,b){return Math.random()*(b-a)+a};h.complileTemplate=function(a){var b=[];a=a.split("<br>");for(var c=0;c<a.length;c++){var d="return '"+a[c].split("<").join("'+ dataset.").split(">").join("+'")+"'";b.push(new Function("dataset",d))}return b};var x=h.decimalAdjust=function(a,b,c){if("undefined"===typeof c||0===+c)return Math[a](b);b=+b;c=+c;if(isNaN(b)||"number"!==typeof c||0!==
c%1)return NaN;b=b.toString().split("e");b=Math[a](+(b[0]+"e"+(b[1]?+b[1]-c:-c)));b=b.toString().split("e");return+(b[0]+"e"+(b[1]?+b[1]+c:c))};Math.round10||(Math.round10=function(a,b){return x("round",a,b)});CanvasRenderingContext2D.prototype.roundRect=function(a,b,c,d,k,e,g){"undefined"==typeof g&&(g=!0);"undefined"===typeof k&&(k=5);this.beginPath();this.moveTo(a+k,b);this.lineTo(a+c-k,b);this.quadraticCurveTo(a+c,b,a+c,b+k);this.lineTo(a+c,b+d-k);this.quadraticCurveTo(a+c,b+d,a+c-k,b+d);this.lineTo(a+
k,b+d);this.quadraticCurveTo(a,b+d,a,b+d-k);this.lineTo(a,b+k);this.quadraticCurveTo(a,b,a+k,b);this.closePath();g&&this.stroke();e&&this.fill()};this.canvas=t.canvas;this.ctx=t;this.initialized=!1;this.functions=[];this.offset={x:0,y:0};this.zoom=0;this.options=h.merge(v,u);this.functionsComp=h.complileTemplate(this.options.toopTips.template);this.canvasWidth=this.canvas.width=this.options.size.width();this.canvasHeight=this.canvas.height=this.options.size.height();this.drawGrid=function(){this.ctx.clearRect(0,
0,this.canvas.width,this.canvas.height);var a=this.canvasWidth=this.canvas.width,b=this.canvasHeight=this.canvas.height,c=this.options.gridSettings.range.xM+this.zoom,d=this.options.gridSettings.range.yM+this.zoom,k=-1*c+(this.options.gridSettings.range.xP-this.zoom)+1,e=-1*d+(this.options.gridSettings.range.yP-this.zoom)+1,g=a/k,f=b/e,l=g*(-1*c+1)-g/2,h=b-(f*(-1*d+1)-f/2),p=this.offset.x/g,n=-1*this.offset.y/f,y=this.offset.x>a/2?0:-1*this.offset.x>a/2?a:l-this.offset.x,m=this.offset.y>b/2?0:-1*
this.offset.y>b/2?b:h-this.offset.y,r=-1*this.offset.x+20>a/2?-10:10,t=this.offset.y+20<b/2?-10:20;this.initialized&&this.ctx.restore();this.ctx.save();this.ctx.lineWidth=2;this.ctx.strokeStyle="#7f8c8d";this.offset.y<b/2&&-1*this.offset.y<b/2&&(this.ctx.beginPath(),this.ctx.moveTo(0,h-this.offset.y),this.ctx.lineTo(a,h-this.offset.y),this.ctx.stroke());this.offset.x<a/2&&-1*this.offset.x<a/2&&(this.ctx.beginPath(),this.ctx.moveTo(l-this.offset.x,0),this.ctx.lineTo(l-this.offset.x,b),this.ctx.stroke());
if(this.options.gridSettings.referenceLines){for(a=Math.floor(p);a<k+Math.floor(p+.5);a++){var q=g*a+g/2-this.offset.x;0!=a+c&&(this.ctx.lineWidth=2,this.ctx.strokeStyle=this.options.gridSettings.colors.axes,this.ctx.beginPath(),this.ctx.moveTo(q,0),this.ctx.lineTo(q,this.canvasHeight),this.ctx.stroke())}for(a=Math.floor(n);a<e+Math.floor(n+.5);a++)q=b-(f*a+f/2)-this.offset.y,0!=a+d&&(this.ctx.lineWidth=2,this.ctx.strokeStyle=this.options.gridSettings.colors.axes,this.ctx.beginPath(),this.ctx.moveTo(0,
q),this.ctx.lineTo(this.canvasWidth,q),this.ctx.stroke())}for(a=Math.floor(p);a<k+Math.floor(p+.5);a++)0!=a+c&&this.drawUnitX(g*a+g/2-this.offset.x,m,a+c,t);for(a=Math.floor(n);a<e+Math.floor(n+.5);a++)0!=a+d&&this.drawUnitY(y,b-(f*a+f/2)-this.offset.y,a+d,r);this.initialized=!0;this.middleX=l;this.middleY=h;this.unitsGapX=g;this.unitsGapY=f};this.drawUnitX=function(a,b,c,d){this.ctx.lineWidth=2;this.ctx.strokeStyle=this.options.gridSettings.colors.temLines;this.ctx.beginPath();this.ctx.moveTo(a,
b-5);this.ctx.lineTo(a,b+5);this.ctx.stroke();this.options.gridSettings.text&&(this.ctx.textAlign="left",this.ctx.font="14px "+this.options.fontType,this.ctx.fillStyle=this.options.gridSettings.colors.text,this.ctx.fillText(c,a-this.ctx.measureText(c.toString()).width/2,b+d))};this.drawUnitY=function(a,b,c,d){this.ctx.lineWidth=2;this.ctx.strokeStyle=this.options.gridSettings.colors.temLines;this.ctx.beginPath();this.ctx.moveTo(a-5,b);this.ctx.lineTo(a+5,b);this.ctx.stroke();this.options.gridSettings.text&&
(this.ctx.textAlign=0>d?"right":"left",this.ctx.font="14px "+this.options.fontType,this.ctx.fillStyle=this.options.gridSettings.colors.text,this.ctx.fillText(c,a+d,b+5))};this.funGraph=function(a,b){var c,d,k=0,e=0,g=[],f=this.middleX,l=this.middleY,h=Math.round((this.canvasWidth-f)/4),p=Math.round(-f/4),n=math.compile(a);this.ctx.beginPath();this.ctx.lineWidth=2;this.ctx.strokeStyle=b;for(var m=p;m<=h;m++){c=4*m;d=this.unitsGapY*n.eval({x:c/this.unitsGapX});if(0<=l-d)e>d&&0>l-e&&(g.push({x:f+k,y:l-
e}),this.ctx.moveTo(f+k-this.offset.x,l-e-this.offset.y)),g.push({x:f+c,y:l-d}),this.ctx.lineTo(f+c-this.offset.x,l-d-this.offset.y);else if(m!=p&&e<d&&0<l-e){c+=4;d=this.unitsGapY*n.eval({x:c/this.unitsGapX});this.ctx.lineTo(f+c-this.offset.x,l-d-this.offset.y);g.push({x:f+c,y:l-d});break}k=c;e=d}this.ctx.stroke();return{compFunction:n,points:g}};this.drawGraphs=function(a){this.drawGrid();this.functions=[];for(var b,c=0;c<a.length;c++){this.functions.push({formula:a[c]});try{this.options.randomColors?
(this.functions[c].color=this.options.colors[Math.round(h.getRandomArbitrary(0,this.options.colors.length-1))],b=this.funGraph(a[c],this.functions[c].color)):(this.functions[c].color=this.options.colors[c],b=this.funGraph(a[c],this.options.colors[c])),this.functions[c].points=b.points,this.functions[c].compiled=b.compFunction}catch(d){"undefined"!==typeof this.errorElem?this.errorElem.innerHTML="<p>"+d.message+"</p>":console.log(d.message)}}};this.addGraphs=function(a){this.initialized||this.drawGrid();
for(var b,c=this.functions.length,d=0;d<a.length;d++)this.functions.push({formula:a[d]});for(d=0;d<a.length;d++)try{this.options.randomColors?(this.functions[d+c].color=this.options.colors[Math.round(h.getRandomArbitrary(0,this.options.colors.length-1))],b=this.funGraph(a[d],this.functions[d+c].color)):(this.functions[d+c].color=this.options.colors[d+c],b=this.funGraph(a[d],this.options.colors[d+c])),this.functions[d+c].points=b.points,this.functions[d+c].compiled=b.compFunction}catch(e){"undefined"!==
typeof this.errorElem?this.errorElem.innerHTML="<p>"+e.message+"</p>":console.log(e.message)}};this.addMissingPoints=function(){for(var a,b,c,d=0;d<this.functions.length;d++){a=this.functions[d].points;if(0<a[0].x-this.offset.x&&a[0].x-this.offset.x<this.canvasWidth&&0<a[0].y-this.offset.y&&a[0].y-this.offset.y<this.canvasHeight){this.ctx.beginPath();this.ctx.lineWidth=2;this.ctx.strokeStyle=this.functions[d].color;for(this.ctx.moveTo(a[0].x-this.offset.x,a[0].y-this.offset.y);0<a[0].x-this.offset.x&&
a[0].x-this.offset.x<this.canvasWidth&&0<a[0].y-this.offset.y&&a[0].y-this.offset.y<this.canvasHeight;)b=a[0].x-this.middleX-4,c=this.unitsGapY*this.functions[d].compiled.eval({x:b/this.unitsGapX}),this.ctx.lineTo(this.middleX+b-this.offset.x,this.middleY-c-this.offset.y),a.unshift({x:this.middleX+b,y:this.middleY-c});this.ctx.stroke()}if(0<a[a.length-1].x-this.offset.x&&a[a.length-1].x-this.offset.x<this.canvasWidth&&0<a[a.length-1].y-this.offset.y&&a[a.length-1].y-this.offset.y<this.canvasHeight){this.ctx.beginPath();
this.ctx.lineWidth=2;this.ctx.strokeStyle=this.functions[d].color;for(this.ctx.moveTo(a[a.length-1].x-this.offset.x,a[a.length-1].y-this.offset.y);0<a[a.length-1].x-this.offset.x&&a[a.length-1].x-this.offset.x<this.canvasWidth&&0<a[a.length-1].y-this.offset.y&&a[a.length-1].y-this.offset.y<this.canvasHeight;)b=a[a.length-1].x-this.middleX+4,c=this.unitsGapY*this.functions[d].compiled.eval({x:b/this.unitsGapX}),this.ctx.lineTo(this.middleX+b-this.offset.x,this.middleY-c-this.offset.y),a.push({x:this.middleX+
b,y:this.middleY-c});this.ctx.stroke()}}};this.updateGraphs=function(){this.drawGrid();for(var a=0;a<this.functions.length;a++){var b=this.functions[a].points;this.ctx.beginPath();this.ctx.lineWidth=2;this.ctx.strokeStyle=this.functions[a].color;this.ctx.moveTo(b[0].x-this.offset.x,b[0].y-this.offset.y);for(var c=1;c<b.length;c++)this.ctx.lineTo(b[c].x-this.offset.x,b[c].y-this.offset.y);this.ctx.stroke()}};this.updateHover=function(a){a.preventDefault();a.stopPropagation();var b=parseInt(a.clientX-
this.canvas.offsetLeft),c=parseInt(a.clientY-this.canvas.offsetTop),d,e,h;for(a=0;a<this.functions.length;a++){h=this.functions[a].points;for(var g=0;g<h.length;g++){d=h[g].x-this.offset.x;e=h[g].y-this.offset.y;if(12>b-d&&-12<b-d&&12>c-e&&-12<c-e){var f=this,b={x:function(a){return Math.round10((d-f.middleX-f.offset.x)/f.unitsGapX,-1*a)},y:function(a){return Math.round10((e-f.middleY-f.offset.y)/f.unitsGapY*-1,-1*a)},formula:this.functions[a].formula};this.updateGraphs();this.ctx.restore();this.ctx.beginPath();
this.ctx.fillStyle=this.functions[a].color;this.ctx.arc(d,e,3,0,2*Math.PI);this.ctx.fill();d=160>this.canvasWidth-d?d-160:d+5;e=90>e?e+5:e-85;this.ctx.shadowBlur=2;this.ctx.shadowColor="black";this.ctx.fillStyle=this.functions[a].color;this.options.toopTips.roundEdges?this.ctx.roundRect(d,e,150,35*this.functionsComp.length+5,5,!0,!1):this.ctx.fillRect(d,e,150,35*this.functionsComp.length+5);this.ctx.shadowBlur=0;this.ctx.fillStyle=this.options.toopTips.fontColor;this.ctx.font="30px "+this.options.fontType;
for(a=0;a<this.functionsComp.length;a++)this.ctx.fillText(this.functionsComp[a](b),d+5,e+25+35*a,140);this.hoverMenu=!0;return}this.hoverMenu&&(this.updateGraphs(),this.hoverMenu=!1)}}};this.updateOffset=function(a,b){"undefined"!==a&&"undefined"!==b&&(this.offset.x=parseInt(b.mouseX-(a.clientX-this.canvas.offsetLeft)),this.offset.y=parseInt(b.mouseY-(a.clientY-this.canvas.offsetTop)));this.updateGraphs();this.addMissingPoints()};this.updateZoom=function(a){a=window.event||a;this.zoom+=Math.max(-1,
Math.min(1,a.wheelDelta||-a.detail));if(-1<this.options.gridSettings.range.xM+this.zoom||1>this.options.gridSettings.range.xP-this.zoom||-1<this.options.gridSettings.range.yM+this.zoom||1>this.options.gridSettings.range.yP-this.zoom)--this.zoom;else{this.drawGrid();for(var b=0;b<this.functions.length;b++)a=this.funGraph(this.functions[b].formula,this.functions[b].color),this.functions[b].points=a.points,this.functions[b].compiled=a.compFunction;this.addMissingPoints()}};this.resizeGraphs=function(){this.drawGrid();
for(var a,b=0;b<this.functions.length;b++)a=this.funGraph(this.functions[b].formula,this.functions[b].color),this.functions[b].points=a.points,this.functions[b].compiled=a.compFunction;this.addMissingPoints()};var r=!1,m=0,e=this;e.mouseState={};(this.options.toopTips.enable||this.options.moveEnable)&&this.canvas.addEventListener("mousemove",function(a){0!=m||r||(e.options.moveEnable&&e.mouseState.down?e.updateOffset(a,e.mouseState):e.options.toopTips.enable&&e.updateHover(a),m+=1,window.setTimeout(function(){--m},
33))});this.options.moveEnable&&(this.canvas.addEventListener("mousedown",function(a){e.mouseState={down:!0,mouseX:parseInt(a.clientX-e.canvas.offsetLeft)+e.offset.x,mouseY:parseInt(a.clientY-e.canvas.offsetTop)+e.offset.y}}),this.canvas.addEventListener("mouseup",function(){e.mouseState.down=!1}),this.canvas.addEventListener("mouseout",function(){e.mouseState.down=!1}));this.options.zoomEnable&&(this.canvas.addEventListener("DOMMouseScroll",function(a){e.updateZoom(a)},!1),this.canvas.addEventListener("mousewheel",
function(a){e.updateZoom(a)},!1));this.options.changeOnResize&&(window.onresize=function(){if(e.canvasWidth!=e.options.size.width()||e.canvasHeight!=e.options.size.height())r=!0,e.canvasWidth=e.canvas.width=e.options.size.width(),e.canvasHeight=e.canvas.height=e.options.size.height(),e.resizeGraphs(),r=!1});return this};
